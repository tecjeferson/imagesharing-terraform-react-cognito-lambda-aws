import { __assign, __awaiter, __generator } from "tslib";
import { ProviderError } from "@aws-sdk/property-provider";
import { httpRequest } from "./remoteProvider/httpRequest";
import { fromImdsCredentials, isImdsCredentials } from "./remoteProvider/ImdsCredentials";
import { providerConfigFromInit } from "./remoteProvider/RemoteProviderInit";
import { retry } from "./remoteProvider/retry";
var IMDS_IP = "169.254.169.254";
var IMDS_PATH = "/latest/meta-data/iam/security-credentials/";
var IMDS_TOKEN_PATH = "/latest/api/token";
/**
 * Creates a credential provider that will source credentials from the EC2
 * Instance Metadata Service
 */
export var fromInstanceMetadata = function (init) {
    if (init === void 0) { init = {}; }
    // when set to true, metadata service will not fetch token
    var disableFetchToken = false;
    var _a = providerConfigFromInit(init), timeout = _a.timeout, maxRetries = _a.maxRetries;
    var getCredentials = function (maxRetries, options) { return __awaiter(void 0, void 0, void 0, function () {
        var profile;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, retry(function () { return __awaiter(void 0, void 0, void 0, function () {
                        var profile, err_1;
                        return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0:
                                    _a.trys.push([0, 2, , 3]);
                                    return [4 /*yield*/, getProfile(options)];
                                case 1:
                                    profile = _a.sent();
                                    return [3 /*break*/, 3];
                                case 2:
                                    err_1 = _a.sent();
                                    if (err_1.statusCode === 401) {
                                        disableFetchToken = false;
                                    }
                                    throw err_1;
                                case 3: return [2 /*return*/, profile];
                            }
                        });
                    }); }, maxRetries)];
                case 1:
                    profile = (_a.sent()).trim();
                    return [2 /*return*/, retry(function () { return __awaiter(void 0, void 0, void 0, function () {
                            var creds, err_2;
                            return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0:
                                        _a.trys.push([0, 2, , 3]);
                                        return [4 /*yield*/, getCredentialsFromProfile(profile, options)];
                                    case 1:
                                        creds = _a.sent();
                                        return [3 /*break*/, 3];
                                    case 2:
                                        err_2 = _a.sent();
                                        if (err_2.statusCode === 401) {
                                            disableFetchToken = false;
                                        }
                                        throw err_2;
                                    case 3: return [2 /*return*/, creds];
                                }
                            });
                        }); }, maxRetries)];
            }
        });
    }); };
    return function () { return __awaiter(void 0, void 0, void 0, function () {
        var token, error_1;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (!disableFetchToken) return [3 /*break*/, 1];
                    return [2 /*return*/, getCredentials(maxRetries, { timeout: timeout })];
                case 1:
                    token = void 0;
                    _a.label = 2;
                case 2:
                    _a.trys.push([2, 4, , 5]);
                    return [4 /*yield*/, getMetadataToken({ timeout: timeout })];
                case 3:
                    token = (_a.sent()).toString();
                    return [3 /*break*/, 5];
                case 4:
                    error_1 = _a.sent();
                    if ((error_1 === null || error_1 === void 0 ? void 0 : error_1.statusCode) === 400) {
                        throw Object.assign(error_1, {
                            message: "EC2 Metadata token request returned error",
                        });
                    }
                    else if (error_1.message === "TimeoutError" || [403, 404, 405].includes(error_1.statusCode)) {
                        disableFetchToken = true;
                    }
                    return [2 /*return*/, getCredentials(maxRetries, { timeout: timeout })];
                case 5: return [2 /*return*/, getCredentials(maxRetries, {
                        timeout: timeout,
                        headers: {
                            "x-aws-ec2-metadata-token": token,
                        },
                    })];
            }
        });
    }); };
};
var getMetadataToken = function (options) { return __awaiter(void 0, void 0, void 0, function () {
    return __generator(this, function (_a) {
        return [2 /*return*/, httpRequest(__assign(__assign({}, options), { host: IMDS_IP, path: IMDS_TOKEN_PATH, method: "PUT", headers: {
                    "x-aws-ec2-metadata-token-ttl-seconds": "21600",
                } }))];
    });
}); };
var getProfile = function (options) { return __awaiter(void 0, void 0, void 0, function () { return __generator(this, function (_a) {
    switch (_a.label) {
        case 0: return [4 /*yield*/, httpRequest(__assign(__assign({}, options), { host: IMDS_IP, path: IMDS_PATH }))];
        case 1: return [2 /*return*/, (_a.sent()).toString()];
    }
}); }); };
var getCredentialsFromProfile = function (profile, options) { return __awaiter(void 0, void 0, void 0, function () {
    var credsResponse, _a, _b;
    return __generator(this, function (_c) {
        switch (_c.label) {
            case 0:
                _b = (_a = JSON).parse;
                return [4 /*yield*/, httpRequest(__assign(__assign({}, options), { host: IMDS_IP, path: IMDS_PATH + profile }))];
            case 1:
                credsResponse = _b.apply(_a, [(_c.sent()).toString()]);
                if (!isImdsCredentials(credsResponse)) {
                    throw new ProviderError("Invalid response received from instance metadata service.");
                }
                return [2 /*return*/, fromImdsCredentials(credsResponse)];
        }
    });
}); };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJvbUluc3RhbmNlTWV0YWRhdGEuanMiLCJzb3VyY2VSb290IjoiLi9zcmMvIiwic291cmNlcyI6WyJmcm9tSW5zdGFuY2VNZXRhZGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBSTNELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUMxRixPQUFPLEVBQUUsc0JBQXNCLEVBQXNCLE1BQU0scUNBQXFDLENBQUM7QUFDakcsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRS9DLElBQU0sT0FBTyxHQUFHLGlCQUFpQixDQUFDO0FBQ2xDLElBQU0sU0FBUyxHQUFHLDZDQUE2QyxDQUFDO0FBQ2hFLElBQU0sZUFBZSxHQUFHLG1CQUFtQixDQUFDO0FBRTVDOzs7R0FHRztBQUNILE1BQU0sQ0FBQyxJQUFNLG9CQUFvQixHQUFHLFVBQUMsSUFBNkI7SUFBN0IscUJBQUEsRUFBQSxTQUE2QjtJQUNoRSwwREFBMEQ7SUFDMUQsSUFBSSxpQkFBaUIsR0FBRyxLQUFLLENBQUM7SUFDeEIsSUFBQSxLQUEwQixzQkFBc0IsQ0FBQyxJQUFJLENBQUMsRUFBcEQsT0FBTyxhQUFBLEVBQUUsVUFBVSxnQkFBaUMsQ0FBQztJQUU3RCxJQUFNLGNBQWMsR0FBRyxVQUFPLFVBQWtCLEVBQUUsT0FBdUI7Ozs7d0JBRXJFLHFCQUFNLEtBQUssQ0FBUzs7Ozs7O29DQUdOLHFCQUFNLFVBQVUsQ0FBQyxPQUFPLENBQUMsRUFBQTs7b0NBQW5DLE9BQU8sR0FBRyxTQUF5QixDQUFDOzs7O29DQUVwQyxJQUFJLEtBQUcsQ0FBQyxVQUFVLEtBQUssR0FBRyxFQUFFO3dDQUMxQixpQkFBaUIsR0FBRyxLQUFLLENBQUM7cUNBQzNCO29DQUNELE1BQU0sS0FBRyxD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RCxDQUFDLENBQUM7aUJBQ3RGO2dCQUVELHNCQUFPLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxFQUFDOzs7S0FDM0MsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByb3ZpZGVyRXJyb3IgfSBmcm9tIFwiQGF3cy1zZGsvcHJvcGVydHktcHJvdmlkZXJcIjtcbmltcG9ydCB7IENyZWRlbnRpYWxQcm92aWRlciwgQ3JlZGVudGlhbHMgfSBmcm9tIFwiQGF3cy1zZGsvdHlwZXNcIjtcbmltcG9ydCB7IFJlcXVlc3RPcHRpb25zIH0gZnJvbSBcImh0dHBcIjtcblxuaW1wb3J0IHsgaHR0cFJlcXVlc3QgfSBmcm9tIFwiLi9yZW1vdGVQcm92aWRlci9odHRwUmVxdWVzdFwiO1xuaW1wb3J0IHsgZnJvbUltZHNDcmVkZW50aWFscywgaXNJbWRzQ3JlZGVudGlhbHMgfSBmcm9tIFwiLi9yZW1vdGVQcm92aWRlci9JbWRzQ3JlZGVudGlhbHNcIjtcbmltcG9ydCB7IHByb3ZpZGVyQ29uZmlnRnJvbUluaXQsIFJlbW90ZVByb3ZpZGVySW5pdCB9IGZyb20gXCIuL3JlbW90ZVByb3ZpZGVyL1JlbW90ZVByb3ZpZGVySW5pdFwiO1xuaW1wb3J0IHsgcmV0cnkgfSBmcm9tIFwiLi9yZW1vdGVQcm92aWRlci9yZXRyeVwiO1xuXG5jb25zdCBJTURTX0lQID0gXCIxNjkuMjU0LjE2OS4yNTRcIjtcbmNvbnN0IElNRFNfUEFUSCA9IFwiL2xhdGVzdC9tZXRhLWRhdGEvaWFtL3NlY3VyaXR5LWNyZWRlbnRpYWxzL1wiO1xuY29uc3QgSU1EU19UT0tFTl9QQVRIID0gXCIvbGF0ZXN0L2FwaS90b2tlblwiO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIHByb3ZpZGVyIHRoYXQgd2lsbCBzb3VyY2UgY3JlZGVudGlhbHMgZnJvbSB0aGUgRUMyXG4gKiBJbnN0YW5jZSBNZXRhZGF0YSBTZXJ2aWNlXG4gKi9cbmV4cG9ydCBjb25zdCBmcm9tSW5zdGFuY2VNZXRhZGF0YSA9IChpbml0OiBSZW1vdGVQcm92aWRlckluaXQgPSB7fSk6IENyZWRlbnRpYWxQcm92aWRlciA9PiB7XG4gIC8vIHdoZW4gc2V0IHRvIHRydWUsIG1ldGFkYXRhIHNlcnZpY2Ugd2lsbCBub3QgZmV0Y2ggdG9rZW5cbiAgbGV0IGRpc2FibGVGZXRjaFRva2VuID0gZmFsc2U7XG4gIGNvbnN0IHsgdGltZW91dCwgbWF4UmV0cmllcyB9ID0gcHJvdmlkZXJDb25maWdGcm9tSW5pdChpbml0KTtcblxuICBjb25zdCBnZXRDcmVkZW50aWFscyA9IGFzeW5jIChtYXhSZXRyaWVzOiBudW1iZXIsIG9wdGlvbnM6IFJlcXVlc3RPcHRpb25zKSA9PiB7XG4gICAgY29uc3QgcHJvZmlsZSA9IChcbiAgICAgIGF3YWl0IHJldHJ5PHN0cmluZz4oYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgcHJvZmlsZTogc3RyaW5nO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHByb2ZpbGUgPSBhd2FpdCBnZXRQcm9maWxlKG9wdGlvbnMpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwMSkge1xuICAgICAgICAgICAgZGlzYWJsZUZldGNoVG9rZW4gPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcm9maWxlO1xuICAgICAgfSwgbWF4UmV0cmllcylcbiAgICApLnRyaW0oKTtcblxuICAgIHJldHVybiByZXRyeShhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgY3JlZHM6IENyZWRlbnRpYWxzO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY3JlZHMgPSBhd2FpdCBnZXRDcmVkZW50aWFsc0Zyb21Qcm9maWxlKHByb2ZpbGUsIG9wdGlvbnMpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSA9PT0gNDAxKSB7XG4gICAgICAgICAgZGlzYWJsZUZldGNoVG9rZW4gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICByZXR1cm4gY3JlZHM7XG4gICAgfSwgbWF4UmV0cmllcyk7XG4gIH07XG5cbiAgcmV0dXJuIGFzeW5jICgpID0+IHtcbiAgICBpZiAoZGlzYWJsZUZldGNoVG9rZW4pIHtcbiAgICAgIHJldHVybiBnZXRDcmVkZW50aWFscyhtYXhSZXRyaWVzLCB7IHRpbWVvdXQgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCB0b2tlbjogc3RyaW5nO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdG9rZW4gPSAoYXdhaXQgZ2V0TWV0YWRhdGFUb2tlbih7IHRpbWVvdXQgfSkpLnRvU3RyaW5nKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3I/LnN0YXR1c0NvZGUgPT09IDQwMCkge1xuICAgICAgICAgIHRocm93IE9iamVjdC5hc3NpZ24oZXJyb3IsIHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiRUMyIE1ldGFkYXRhIHRva2VuIHJlcXVlc3QgcmV0dXJuZWQgZXJyb3JcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvci5tZXNzYWdlID09PSBcIlRpbWVvdXRFcnJvclwiIHx8IFs0MDMsIDQwNCwgNDA1XS5pbmNsdWRlcyhlcnJvci5zdGF0dXNDb2RlKSkge1xuICAgICAgICAgIGRpc2FibGVGZXRjaFRva2VuID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZ2V0Q3JlZGVudGlhbHMobWF4UmV0cmllcywgeyB0aW1lb3V0IH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdldENyZWRlbnRpYWxzKG1heFJldHJpZXMsIHtcbiAgICAgICAgdGltZW91dCxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwieC1hd3MtZWMyLW1ldGFkYXRhLXRva2VuXCI6IHRva2VuLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xufTtcblxuY29uc3QgZ2V0TWV0YWRhdGFUb2tlbiA9IGFzeW5jIChvcHRpb25zOiBSZXF1ZXN0T3B0aW9ucykgPT5cbiAgaHR0cFJlcXVlc3Qoe1xuICAgIC4uLm9wdGlvbnMsXG4gICAgaG9zdDogSU1EU19JUCxcbiAgICBwYXRoOiBJTURTX1RPS0VOX1BBVEgsXG4gICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIFwieC1hd3MtZWMyLW1ldGFkYXRhLXRva2VuLXR0bC1zZWNvbmRzXCI6IFwiMjE2MDBcIixcbiAgICB9LFxuICB9KTtcblxuY29uc3QgZ2V0UHJvZmlsZSA9IGFzeW5jIChvcHRpb25zOiBSZXF1ZXN0T3B0aW9ucykgPT5cbiAgKGF3YWl0IGh0dHBSZXF1ZXN0KHsgLi4ub3B0aW9ucywgaG9zdDogSU1EU19JUCwgcGF0aDogSU1EU19QQVRIIH0pKS50b1N0cmluZygpO1xuXG5jb25zdCBnZXRDcmVkZW50aWFsc0Zyb21Qcm9maWxlID0gYXN5bmMgKHByb2ZpbGU6IHN0cmluZywgb3B0aW9uczogUmVxdWVzdE9wdGlvbnMpID0+IHtcbiAgY29uc3QgY3JlZHNSZXNwb25zZSA9IEpTT04ucGFyc2UoXG4gICAgKFxuICAgICAgYXdhaXQgaHR0cFJlcXVlc3Qoe1xuICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICBob3N0OiBJTURTX0lQLFxuICAgICAgICBwYXRoOiBJTURTX1BBVEggKyBwcm9maWxlLFxuICAgICAgfSlcbiAgICApLnRvU3RyaW5nKClcbiAgKTtcblxuICBpZiAoIWlzSW1kc0NyZWRlbnRpYWxzKGNyZWRzUmVzcG9uc2UpKSB7XG4gICAgdGhyb3cgbmV3IFByb3ZpZGVyRXJyb3IoXCJJbnZhbGlkIHJlc3BvbnNlIHJlY2VpdmVkIGZyb20gaW5zdGFuY2UgbWV0YWRhdGEgc2VydmljZS5cIik7XG4gIH1cblxuICByZXR1cm4gZnJvbUltZHNDcmVkZW50aWFscyhjcmVkc1Jlc3BvbnNlKTtcbn07XG4iXX0=